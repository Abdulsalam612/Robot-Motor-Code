#include <PS4Controller.h>
#include <ESP32_Servo.h>

Servo motor1;
Servo motor2;
Servo motor3;
Servo motor4;

const int in1 = 12;
const int in2 = 14;
const int in3 = 27;
const int in4 = 26;

void setup() {
  Serial.begin(115200);
  PS4.begin("3C:22:FB:52:B2:4A");

  attachMotors();
  initializeMotors();
}

void loop() {
  controlMotors();
}

void attachMotors() {
  motor1.attach(in1);
  motor2.attach(in2);
  motor3.attach(in3);
  motor4.attach(in4);
}

void initializeMotors() {
  motor1.write(90);
  motor2.write(90);
  motor3.write(90);
  motor4.write(90);
  delay(5000);
}

void controlMotors() {
  int lx = PS4.LStickX();
  int ly = PS4.LStickY();
  int ry = PS4.RStickY();
  int rx = PS4.RStickX();

  if (PS4.Triangle()) {
    changeMotorSpeed(90, 39, -10);
  }
  if (PS4.Circle()) {
    changeMotorSpeed(90, 131, 10);
  }

  // More control logic here...
}

void changeMotorSpeed(int start, int end, int step) {
  for (int i = start; i != end; i += step) {
    motor1.write(i);
    motor2.write(i);
    motor3.write(i);
    motor4.write(i);
    delay(20);
  }
}

void dance() {
  // Dance moves for the car
  // Add the dance moves logic here...
}
